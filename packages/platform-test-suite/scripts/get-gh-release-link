#!/usr/bin/env node

const GitHub = require('github-api');
const semver = require('semver');

const { version } = require('../package.json');

async function main() {
  const [repoUser, repoName] = process.argv[2].split('/');

  const suiteVersion = semver.coerce(version);

  const gh = new GitHub();

  const { data: releases } = await gh.getRepo(repoUser, repoName)
    .listReleases();

  const [matchingRelease] = releases
    .sort((releaseA, releaseB) => (
      semver.compare(releaseB.tag_name, releaseA.tag_name)
    ))
    .filter((release) => (
      semver.satisfies(
        release.tag_name, `${suiteVersion.major}.${suiteVersion.minor}`,
      )
    ));

  console.log(matchingRelease.tarball_url);
}

main().catch((e) => {
  console.error(e);
  process.exit(1);
});
